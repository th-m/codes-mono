import{h as F,m as b,j as N,g as H,k as A,s as I,l as O,i as P,r as U,t as $,o as j,n as J,b as S,p as B,q as M,v as g,w as X,c as G}from"./entry-client.9d21cc98.js";class v extends Error{constructor(e,{status:r,stack:n}={}){super(e),this.name="ServerError",this.status=r||400,n&&(this.stack=n)}}class x extends v{constructor(e,{fieldErrors:r={},form:n,fields:o,stack:c}={}){super(e,{stack:c}),this.formError=e,this.name="FormError",this.fields=o||Object.fromEntries(typeof n<"u"?n.entries():[])||{},this.fieldErrors=r}}const W=$("<form>");let _=t=>{let[e,r]=F(b({reloadDocument:!1,replace:!1,method:"post",action:"/",encType:"application/x-www-form-urlencoded"},t),["reloadDocument","replace","method","action","encType","onSubmission","onSubmit","children","ref"]),n=V(a=>{e.onSubmission&&e.onSubmission(a)}),o=e.method.toLowerCase()==="get"?"get":"post",c=null,i=null;return N(()=>{if(!i)return;function a(u){if(!(u.target instanceof HTMLElement||u.target instanceof SVGElement))return;let f=u.target.closest("button,input[type=submit]");f&&f.type==="submit"&&(c=f)}i.addEventListener("click",a),j(()=>{i&&i.removeEventListener("click",a)})},[]),(()=>{const a=H(W);return A(u=>{i=u,typeof e.ref=="function"&&e.ref(u)},a),I(a,"method",o),O(a,b({get action(){return t.action},get enctype(){return e.encType},get onSubmit(){return e.reloadDocument?void 0:u=>{e.onSubmit&&e.onSubmit(u),!u.defaultPrevented&&(u.preventDefault(),n(c||u.currentTarget,{method:e.method,replace:e.replace}),c=null)}}},r),!1,!0),P(a,()=>e.children),U(),a})()};function V(t){return(e,r={})=>{let n,o,c,i;if(z(e)){let s=r.submissionTrigger;n=r.method||e.method,o=r.action||e.action,c=r.encType||e.enctype,i=new FormData(e),s&&s.name&&i.append(s.name,s.value)}else if(R(e)||K(e)&&(e.type==="submit"||e.type==="image")){let s=e.form;if(s==null)throw new Error("Cannot submit a <button> without a <form>");n=r.method||e.getAttribute("formmethod")||s.method,o=r.action||e.getAttribute("formaction")||s.action,c=r.encType||e.getAttribute("formenctype")||s.enctype,i=new FormData(s),e.name&&i.set(e.name,e.value)}else{if(y(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');if(n=r.method||"get",o=r.action||"/",c=r.encType||"application/x-www-form-urlencoded",e instanceof FormData)i=e;else if(i=new FormData,e instanceof URLSearchParams)for(let[s,d]of e)i.append(s,d);else if(e!=null)for(let s of Object.keys(e))i.append(s,e[s])}let{protocol:a,host:u}=window.location,f=new URL(R(o)?"/":o,`${a}//${u}`);if(n.toLowerCase()==="get")for(let[s,d]of i)if(typeof d=="string")f.searchParams.append(s,d);else throw new Error("Cannot submit binary form data using GET");let m={formData:i,action:f.pathname+f.search,method:n.toUpperCase(),encType:c};t(m)}}function y(t){return t!=null&&typeof t.tagName=="string"}function R(t){return y(t)&&t.tagName.toLowerCase()==="button"}function z(t){return y(t)&&t.tagName.toLowerCase()==="form"}function K(t){return y(t)&&t.tagName.toLowerCase()==="input"}const h="Location",q="content-type",Q="x-solidstart-response-type",Y="x-solidstart-content-type",Z="x-solidstart-origin",ee="application/json";function T(t,e=302){let r=e;typeof r=="number"?r={status:r}:typeof r.status>"u"&&(r.status=302),t===""&&(t="/");let n=new Headers(r.headers);return n.set(h,t),new Response(null,{...r,headers:n})}const te=new Set([204,301,302,303,307,308]);function E(t){return t&&t instanceof Response&&te.has(t.status)}const re=new Set;function ne(t){return J(()=>{for(let e of re)e(t)})}function ie(t,e={}){let r=oe(t);const[n,o]=S(r.input),[c,i]=S(r.result),a=B(),u=M();let f=0;function m(s){const d=t(s,u),w=++f;return g(()=>{i(void 0),o(()=>s)}),d.then(async l=>(w===f&&(l instanceof Response?await k(l,a,e):await D(l,e),!l||E(l)?o(void 0):i({data:l})),l)).catch(async l=>{w===f&&(l instanceof Response&&await k(l,a,e),E(l)?o(void 0):i({error:l}))})}return m.url=t.url,m.Form=s=>{let d=t.url;return G(_,b(s,{action:d,onSubmission:w=>{m(w.formData)},get children(){return s.children}}))},[{get pending(){return!!n()&&!c()},get input(){return n()},get result(){return c()?.data},get error(){return c()?.error},clear(){g(()=>{o(void 0),i(void 0)})},retry(){const s=n();if(!s)throw new Error("No submission to retry");m(s)}},m]}function D(t,e={}){return ne(typeof e.invalidate=="function"?e.invalidate(t):e.invalidate)}function k(t,e,r){if(t instanceof Response&&E(t)){const n=t.headers.get("Location")||"/";n.startsWith("http")?window.location.href=n:e(n)}return D(t,r)}function oe(t){const[e]=X();let r=e.form?JSON.parse(e.form):null;if(!r||r.url!==t.url)return{};const n=new Map(r.entries);return{result:{error:r.error?new x(r.error.message,{fieldErrors:r.error.fieldErrors,stack:r.error.stack,form:r.error.form,fields:r.error.fields}):void 0},input:n}}async function L(t,e){const r=e.headers.get(Y)||e.headers.get(q)||"";if(r.includes("json"))return await e.json();if(r.includes("text"))return await e.text();if(r.includes("server-error")){const n=await e.json();return new v(n.error.message,{stack:n.error.stack,status:e.status})}else if(r.includes("form-error")){const n=await e.json();return new x(n.error.message,{fieldErrors:n.error.fieldErrors,fields:n.error.fields,stack:n.error.stack})}else if(r.includes("error")){const n=await e.json(),o=new Error(n.error.message);return n.error.stack&&(o.stack=n.error.stack),o}else{if(r.includes("response"))return e.status===204&&e.headers.get(h)?T(e.headers.get(h)):e;if(e.status===200){const n=await e.text();try{return JSON.parse(n)}catch{}}return e.status===204&&e.headers.get(h)?T(e.headers.get(h)):e}}const p=t=>{throw new Error("Should be compiled away")};function C(...t){let e,r={[Z]:"client"};if(t[0]instanceof FormData)e=t[0];else{if(Array.isArray(t)&&t.length>2){let n=t[1];typeof n=="object"&&"value"in n&&"refetching"in n&&(n.value=void 0)}e=JSON.stringify(t,(n,o)=>o instanceof Headers?{$type:"headers",values:[...o.entries()]}:o instanceof Request?{$type:"request",url:o.url,method:o.method,headers:o.headers}:o),r[q]=ee}return{method:"POST",body:e,headers:new Headers({...r})}}p.createFetcher=(t,e)=>{let r=function(...n){const o=e?C(n[0]):C(...n);return p.call(t,o)};return r.url=t,r.fetch=n=>p.call(t,n),r};p.call=async function(t,e){const r=new Request(new URL(t,window.location.href).href,e),n=await fetch(r);if(n.headers.get(Q)==="throw")throw await L(r,n);return await L(r,n)};p.fetch=async function(t,e){if(t instanceof URL||t.startsWith("http"))return await fetch(t,e);const r=new Request(new URL(t,window.location.href).href,e);return await fetch(r)};export{ie as c,p as s};
